# VPC App Spec Template
# Deploy with: doctl apps create --spec .do/app-vpc.yaml
#
# Required: Update the following before deployment:
# - vpc.id: Your VPC UUID
# - github.repo: Your forked repository
# - DATABASE_URL: Your PostgreSQL connection string (use private hostname)

name: benchmark-vpc-app
region: syd  # Change to your preferred region
features:
  - buildpack-stack=ubuntu-22

# VPC Configuration - Required for private database connectivity
vpc:
  id: YOUR_VPC_UUID  # Get with: doctl vpcs list

services:
  - name: api
    github:
      repo: YOUR_GITHUB_USERNAME/appplat-vpc-benchmark
      branch: main
      deploy_on_push: false
    http_port: 3000
    instance_size_slug: apps-s-1vcpu-0.5gb
    instance_count: 1
    run_command: npm start
    envs:
      - key: APP_TYPE
        scope: RUN_TIME
        value: VPC
      - key: USE_POOL
        scope: RUN_TIME
        value: "true"
      - key: POOL_SIZE
        scope: RUN_TIME
        value: "10"
      # Use private hostname for VPC connectivity
      # Format: postgresql://user:pass@private-<host>:25061/benchmark-pool?sslmode=require
      - key: DATABASE_URL
        scope: RUN_TIME
        type: SECRET
        value: YOUR_PRIVATE_DATABASE_URL
